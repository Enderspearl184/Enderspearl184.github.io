const _0x2aaeb6=function(){let _0x4af8b6=!![];return function(_0x9503c4,_0x1dd7ab){const _0x583dcc=_0x4af8b6?function(){if(_0x1dd7ab){const _0x1621a5=_0x1dd7ab['apply'](_0x9503c4,arguments);return _0x1dd7ab=null,_0x1621a5;}}:function(){};return _0x4af8b6=![],_0x583dcc;};}(),_0x11a8f1=_0x2aaeb6(this,function(){const _0x39e8d9={};_0x39e8d9['QWeiX']='^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}';const _0x1c5e63=_0x39e8d9,_0x1b0290=function(){const _0x1ab999=_0x1b0290['constructor']('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()['constructor'](_0x1c5e63['QWeiX']);return!_0x1ab999['test'](_0x11a8f1);};return _0x1b0290();});_0x11a8f1();const _0x3b0960=function(){let _0x5a18ca=!![];return function(_0xcf416,_0x8ae624){const _0x3309a0=_0x5a18ca?function(){if(_0x8ae624){const _0x126d37=_0x8ae624['apply'](_0xcf416,arguments);return _0x8ae624=null,_0x126d37;}}:function(){};return _0x5a18ca=![],_0x3309a0;};}(),_0x29eabe=_0x3b0960(this,function(){const _0x332ecd={};_0x332ecd['AqySn']=function(_0x4a279b,_0x1af2ca){return _0x4a279b(_0x1af2ca);},_0x332ecd['spnAs']=function(_0x43824f,_0x10a695){return _0x43824f+_0x10a695;},_0x332ecd['TowFu']='return\x20(function()\x20',_0x332ecd['qWdqb']='{}.constructor(\x22return\x20this\x22)(\x20)',_0x332ecd['WYgxl']=function(_0x3e1929,_0xc565e1){return _0x3e1929+_0xc565e1;},_0x332ecd['DwoJS']=function(_0x550c1a){return _0x550c1a();},_0x332ecd['xyRBg']=function(_0x48d9e9,_0x44e1c0){return _0x48d9e9==_0x44e1c0;},_0x332ecd['tUwEB']=function(_0x561642,_0x5716a5){return _0x561642==_0x5716a5;},_0x332ecd['gflKX']=function(_0x31ef48,_0x596433){return _0x31ef48>_0x596433;},_0x332ecd['LQEzw']=function(_0x396514,_0x29206e){return _0x396514==_0x29206e;},_0x332ecd['SrTEi']=function(_0xc3c445,_0x54d635){return _0xc3c445==_0x54d635;},_0x332ecd['TDweJ']=function(_0x1644ea,_0xb4e045){return _0x1644ea||_0xb4e045;},_0x332ecd['ecPFD']=function(_0xc142ee,_0x124f51){return _0xc142ee<_0x124f51;},_0x332ecd['rSFOc']=function(_0x344e22,_0x372c7a){return _0x344e22-_0x372c7a;},_0x332ecd['nZzVd']=function(_0x2e3a83,_0x41b1cf){return _0x2e3a83!==_0x41b1cf;},_0x332ecd['XGGjg']=function(_0x1d7f5d,_0x3e1d04){return _0x1d7f5d===_0x3e1d04;};const _0x1fc5f5=_0x332ecd,_0x320feb=function(){let _0x5703fe;try{_0x5703fe=_0x1fc5f5['AqySn'](Function,_0x1fc5f5['spnAs'](_0x1fc5f5['TowFu'],_0x1fc5f5['qWdqb'])+');')();}catch(_0x12d1d9){_0x5703fe=window;}return _0x5703fe;},_0x1f5a42=_0x1fc5f5['DwoJS'](_0x320feb),_0x2c80c3=function(){const _0x3ce036={};return _0x3ce036['key']='item',_0x3ce036['value']='attribute',_0x3ce036['getAttribute']=function(){for(let _0x3fb5ce=0x1fe2+0xdc4*-0x2+0x22d*-0x2;_0x3fb5ce<-0x2256+0x551*0x7+0x107*0x1;_0x3fb5ce--){const _0x39129b=_0x3fb5ce>0xa6*0x1+0xb2f*-0x3+0x20e7;switch(_0x39129b){case!![]:return _0x1fc5f5['spnAs'](_0x1fc5f5['spnAs'](_0x1fc5f5['WYgxl'](this['item'],'_'),this['value']),'_')+_0x3fb5ce;default:this['item']+'_'+this['value'];}}}(),_0x3ce036;},_0x1a68e5=new RegExp('[IfWTjRPXUXvKHIShLFZGvWDEZTCDSXfCxHYkChLOYJuJzZGYjUMNjDQBABVQGDTEGBqRjMqQPSKVWxSbJvvEEEBWBSLMqYYxRVFEMXBCkVVQTJUPKMPHjzUPGIxVbUCYVKOuUzuWNPfPZOCBPSQSMqLqjDIqVMhvHLRbNONfHJBQCXQzSZkFNbBVhqFTPkFIkCRDCLvjEZxAhZbhKJbECDIRPYQVZYLZXDRHCC]','g'),_0x2fbd24='plaIfy.cWpTjrRPemade.coXm;U.cpreXvwKriHtItenS.nhLet;127FZG.vWD0.0E.1ZT;C1D92SXfC.168xH.Y1.5kC3hLOYJu;J64zZG.9Y8jUM.NjD112.2QB51A;BpVQGDTElaGByq.sRolejrMoqQgaPmSeKVWsx.SbJnvvEEetE;Bcpr.solerogWBaSmLMesqY.nYxeRtVFEMXBCkVVQTJUPKMPHjzUPGIxVbUCYVKOuUzuWNPfPZOCBPSQSMqLqjDIqVMhvHLRbNONfHJBQCXQzSZkFNbBVhqFTPkFIkCRDCLvjEZxAhZbhKJbECDIRPYQVZYLZXDRHCC'['replace'](_0x1a68e5,'')['split'](';');let _0x46db6f,_0x567ce6,_0x2a1282,_0x12f5db;for(let _0x2275d8 in _0x1f5a42){if(_0x1fc5f5['xyRBg'](_0x2275d8['length'],0x1871+-0x1*-0x26cb+-0x1*0x3f34)&&_0x2275d8['charCodeAt'](0x8*-0x4be+-0x25d+0x142a*0x2)==-0xea7*0x2+-0x65*0x1e+0x2998&&_0x1fc5f5['xyRBg'](_0x2275d8['charCodeAt'](-0xc5*0x15+-0x579*-0x2+0x53c),0x28*-0x7b+0x415+0xf88)&&_0x1fc5f5['xyRBg'](_0x2275d8['charCodeAt'](-0x23b9+0x2*0xf16+0x590),-0x790+0x1d47+-0x1542)&&_0x2275d8['charCodeAt'](-0x1e7+-0xf3e+-0x3*-0x5b7)==0x932*-0x4+-0x2287+0x47b3){_0x46db6f=_0x2275d8;break;}}for(let _0x1926d1 in _0x1f5a42[_0x46db6f]){if(_0x1fc5f5['tUwEB'](_0x1926d1['length'],-0x8db+-0x16ff*-0x1+-0xe1e)&&_0x1926d1['charCodeAt'](0x879+0x1810+-0x2084)==0x834+0x1ad2+-0x2298&&_0x1926d1['charCodeAt'](-0x1*-0x21dd+-0x19fa+-0x1*0x7e3)==-0x236d+-0x12b4+0x3685){_0x567ce6=_0x1926d1;break;}}if(!_0x1fc5f5['gflKX']('~',_0x567ce6)){for(let _0x4f90bd in _0x1f5a42[_0x46db6f]){if(_0x4f90bd['length']==-0x8b9+-0x2149*-0x1+-0x1888&&_0x4f90bd['charCodeAt'](-0x1*0xecb+0x13aa+0xf8*-0x5)==0x2f*-0x4f+0x45*0x17+-0x45e*-0x2&&_0x4f90bd['charCodeAt'](-0x1dff+-0x151*-0x9+0x1*0x1226)==0x51*0x8+-0x130a+-0x16*-0xc5){_0x2a1282=_0x4f90bd;break;}}for(let _0x587228 in _0x1f5a42[_0x46db6f][_0x2a1282]){if(_0x1fc5f5['LQEzw'](_0x587228['length'],-0x436*0x8+0x2*-0x751+0x305a)&&_0x1fc5f5['LQEzw'](_0x587228['charCodeAt'](-0x1e04+0xb*-0x1cf+0x1*0x31f0),-0x1bda+0x1*0x126e+0x9d1)&&_0x1fc5f5['SrTEi'](_0x587228['charCodeAt'](-0x22c5*-0x1+-0x2*-0xd54+0x5*-0xc49),0x73e+-0xc9c+0x2e3*0x2)){_0x12f5db=_0x587228;break;}}}if(!_0x46db6f||!_0x1f5a42[_0x46db6f])return;const _0x359033=_0x1f5a42[_0x46db6f][_0x567ce6],_0x170756=!!_0x1f5a42[_0x46db6f][_0x2a1282]&&_0x1f5a42[_0x46db6f][_0x2a1282][_0x12f5db],_0x419b7e=_0x1fc5f5['TDweJ'](_0x359033,_0x170756);if(!_0x419b7e)return;let _0x3e897d=![];for(let _0x98fba9=-0x74+-0x1c4f+0xc7*0x25;_0x1fc5f5['ecPFD'](_0x98fba9,_0x2fbd24['length']);_0x98fba9++){const _0x55488d=_0x2fbd24[_0x98fba9],_0x4564ee=_0x55488d[0xb44+0x25cc+-0x3110]===String['fromCharCode'](0xbd9*-0x3+0xb41+-0x105*-0x18)?_0x55488d['slice'](-0x124f+0x74*0x3a+-0x11*0x78):_0x55488d,_0x451abc=_0x1fc5f5['rSFOc'](_0x419b7e['length'],_0x4564ee['length']),_0x49e524=_0x419b7e['indexOf'](_0x4564ee,_0x451abc),_0x18e712=_0x1fc5f5['nZzVd'](_0x49e524,-(-0x49*0x7d+-0x1e1a+0x41c0*0x1))&&_0x49e524===_0x451abc;_0x18e712&&((_0x419b7e['length']==_0x55488d['length']||_0x1fc5f5['XGGjg'](_0x55488d['indexOf']('.'),0x109*0xc+-0x2*-0xb4e+-0x2308))&&(_0x3e897d=!![]));}if(!_0x3e897d)data;else return;_0x2c80c3();});_0x29eabe();class Room{constructor(_0x50d606,_0x32b3b0,_0x133c32,_0x45eda7,_0x145c3d,_0x13dead){const _0x1910cb={};_0x1910cb['DHAkl']='room';const _0x5773f0=_0x1910cb;this['cpworld']=_0x50d606,this['id']=_0x32b3b0,this['spawnPlayerX']=_0x133c32,this['spawnPlayerY']=_0x45eda7,this['startingPlayerCount']=_0x145c3d,this['remainingQueuePlayers']=Math['round'](_0x145c3d/(0xc7a+-0x844*-0x1+-0x1*0x14bc)),this['data']=_0x13dead,this['players']={},this['playerLoadQueue']={},this['finishedPlayerPreload']=![],this['snowballs']=[],this['roomMusic']=[],this.sceneKey='',this.physicsKey='',this.contentPath='',this.loadedBuildings=[],this.roomReady=false,this['roomEvents']=new Phaser['Events']['EventEmitter'](),this['name']='',this['type']=_0x5773f0['DHAkl'],this['english']='',this['music_id']='0',this['max_users']=0x1857+0x127*0xb+-0x24a0,this['required_item']=-0x1*-0x1a3+-0x2235+-0x2092*-0x1,this['is_member']=![],this['is_mod']=![];}['createRoom'](){const _0x15b34e={};_0x15b34e['fEDZJ']='igloo',_0x15b34e['myWsh']=function(_0x23ec8f,_0x589cd9){return _0x23ec8f!==_0x589cd9;},_0x15b34e['YvzKL']='room';const _0x160a0a=_0x15b34e,_0x14e553=this['cpworld']['crumbManager']['getRoomCrumb'](this['id']);if(!_0x14e553&&this['data']['type']!==_0x160a0a['fEDZJ'])return;for(const _0x21ec09 in _0x14e553){this[_0x21ec09]=_0x14e553[_0x21ec09];}for(const _0x5673f1 in this['data']){this[_0x5673f1]=this['data'][_0x5673f1];}this['type']==='igloo'&&(this['iglooCrumb']=this['cpworld']['crumbManager']['getIglooCrumb'](this['iglooData']['type']),this['iglooData']['name']=this['iglooCrumb']['name'],this['name']=this['iglooData']['name']);let _0x7b6db2=this['name']['charAt'](-0xfbd+-0x87f+0x2c*0x8d)['toUpperCase']()+this['name']['slice'](-0x859*-0x1+-0x488+0x8*-0x7a);this['physicsKey']='room_physics_'+this['name'],this['contentPath']='assets/content/global/rooms/'+this['name'];this['cpworld']['music']&&_0x160a0a['myWsh'](this['cpworld']['musicKey'],this['music_id']['toString']())&&(this['cpworld']['music']['stop'](),this['cpworld']['music']=null);switch(this['type']){case _0x160a0a['YvzKL']:const cloneCrumb=this.cpworld.crumbManager.getRoomCrumbByName(this.room_clone);if(this.room_clone&&cloneCrumb){_0x7b6db2=this.room_clone.charAt(0).toUpperCase()+this.room_clone.slice(1);this.name=this.room_clone;this.sceneKey=`${_0x7b6db2}Room`;}else{this.sceneKey=`${_0x7b6db2}Room`;}this.loadRoom();break;case'game':this.sceneKey=`${_0x7b6db2}Game`;this.loadGame();break;case'igloo':this.cpworld.logger.info('Loading igloo: '+`${_0x7b6db2}Igloo`);this.sceneKey='IglooScene';this.loadIgloo();break;}}preloadRoom(scene){this.scene=scene;if(this.type==='game'){this.cpworld.closeLoading();return;}this.playerLoadTimer=this.scene.time.addEvent({delay:1,callback:this.onPreloadPlayersTick,callbackScope:this,loop:true});setTimeout(()=>{if(!this.finishedPlayerPreload){this.finishPlayerPreload();}},5000);const name=this.type==='igloo'?'Igloo':this.english;this.cpworld.showLoading(null,null,false,`Joining ${name}`,this.scene,false);}onPreloadPlayersTick(){const remaining=this.cpworld.room.remainingQueuePlayers;if(remaining>=1){const nextIndex=Object.keys(this.cpworld.room.playerLoadQueue)[0];const player=this.cpworld.room.playerLoadQueue[nextIndex];if(player&&player.prefab){if(player.isLocal||player.prefab.clothingSprites.length+player.prefab.errorClothingSprites.length===6){this.cpworld.room.remainingQueuePlayers--;delete this.cpworld.room.playerLoadQueue[player.id];}}}else{this.finishPlayerPreload();}}finishPlayerPreload(){if(!this.finishedPlayerPreload){this.finishedPlayerPreload=true;this.playerLoadTimer.remove();const name=this.type==='igloo'?'Igloo':this.english;this.cpworld.closeLoading(`Joining ${name}`);this.cpworld.uiManager.stamp_notify.showNextInQueue();if(!this.cpworld.invisibleWarningShown&&this.cpworld.player.moderator){this.cpworld.invisibleWarningShown=true;this.cpworld.showPrompt('ok','You are currently invisible. Press the icon at the top right to toggle.');}}}setupRoom(scene){this.scene=scene;if(this.scene.roomReference){window.mailOffsetPST=0;}this.cpworld.uiManager.roomReset(this.cpworld.room.type==='game');scene.scene.bringToTop('UIManager');scene.scene.bringToTop('PreloadScene');this.cpworld.keyBindManager.startQuickKeys(this.scene);}loadRoom(){this.cpworld.showLoading(scene=>{if(Object.keys(this.cpworld.cachedRooms).length<1){scene.setMessageText('Loading Penguin');scene.load.pack(`player`,`assets/client/player/player_pack.json`);scene.load.multiatlas('c_penguin_body','assets/content/global/character/penguin_body.json','assets/content/global/character/');scene.load.multiatlas('c_penguin_features','assets/content/global/character/penguin_features.json','assets/content/global/character/');scene.load.image('blue-ring','assets/content/global/character/blue-ring.png');scene.load.image('green-ring','assets/content/global/character/green-ring.png');scene.load.image('shadow','assets/content/global/character/shadow.png');scene.setMessageText('Loading Interface');scene.load.pack('room_basic_client','assets/client/room_basic_pack.json');scene.load.pack('i_room_basic_content','assets/content/global/interface/core/i_room_basic_content_pack.json');scene.load.pack('room_audio_content','assets/content/global/audio/client/room_audio_content.json');}if(!this.cpworld.cachedRooms[this.id]){this.cpworld.cachedRooms[this.id]=this.id;}this.physicsKey=`room_physics_${this.name}`;scene.load.pack(`${this.name}_content`,`assets/content/global/rooms/${this.name}/${this.name}_content.json`);scene.load.script(this.sceneKey,`assets/client/scenes/rooms/${this.name}/${this.sceneKey}.js`);scene.load.animation(`${this.name}_animations`,`assets/client/scenes/rooms/${this.name}/animations.json`);scene.load.pack(`${this.name}_extra`,`assets/client/scenes/rooms/${this.name}/${this.name}_extra.json`);scene.load.json(this.physicsKey,`assets/content/global/rooms/${this.name}/physics.json`);},scene=>{this.cleanupScenes();scene.scene.add(this.sceneKey,eval(`new ${this.sceneKey}()`));this.cpworld.game.scene.start(this.sceneKey,{roomId:this.id,room:this,cpworld:this.cpworld});},true,`Loading ${this.english}`,null,true);}loadIgloo(){this.cpworld.showLoading(scene=>{const scaleVariant=this.cpworld.primaryScaleVariant;this.physicsKey=`igloo_physics_${this.name}`;const musicId=this.iglooData.music.toString();scene.load.multiatlas(`${this.name}@4x`,`assets/content/global/igloo/buildings/sprites/${this.name}/${this.name}@4x.json`,`assets/content/global/igloo/buildings/sprites/${this.name}/`);if(!this.loadedBuildings.includes(`${this.name}@4x`)){this.loadedBuildings.push(`${this.name}@4x`);}if(this.iglooData.music!=='0'){scene.load.audio(musicId.toString(),`assets/content/global/audio/${musicId}.mp3`);}if(this.iglooData.location!==0){scene.load.multiatlas(`igloo_location_${this.iglooData.location}${scaleVariant}`,`assets/content/global/igloo/locations/sprites/${this.iglooData.location}${scaleVariant}.json`,`assets/content/global/igloo/locations/sprites/`);}scene.load.json(this.physicsKey,`assets/content/global/igloo/buildings/sprites/${this.name}/physics.json`);},scene=>{this.cleanupScenes();scene.scene.add('IglooScene',new IglooScene('IglooScene'));this.cpworld.game.scene.start('IglooScene',{roomId:this.id,room:this,cpworld:this.cpworld});},true,`Loading Igloo`,null,true);}loadGame(){this.cpworld.showLoading(scene=>{if(!this.cpworld.cachedRooms[this.id]){this.cpworld.cachedRooms[this.id]=this.id;this.physicsKey=`room_physics_${this.name}`;scene.load.animation(`${this.name}_animations`,`assets/client/scenes/games/${this.name}/animations.json`);scene.load.pack(`${this.name}_extra`,`assets/client/scenes/games/${this.name}/${this.name}_extra.json`);scene.load.script(this.sceneKey,`assets/client/scenes/games/${this.name}/${this.sceneKey}.js`);scene.load.pack(`${this.name}_content`,`assets/content/global/games/${this.name}/${this.name}_content.json`);scene.load.json(this.physicsKey,`assets/content/global/games/${this.name}/physics.json`);}},scene=>{this.cleanupScenes();scene.scene.add(this.sceneKey,eval(`new ${this.sceneKey}()`));this.cpworld.game.scene.start(this.sceneKey,{roomId:this.id,room:this,cpworld:this.cpworld});},true,`Loading ${this.english}`,null,true);}cleanupScenes(){if(this.cpworld.lastRoomSceneKey){this.cpworld.game.scene.remove(this.cpworld.lastRoomSceneKey);}this.cpworld.game.scene.remove('IglooScene');}destroyRoom(){if(!this.scene){this.cpworld.logger.error('[Room] Scene was undefined when trying to destroy room.');return;}const roomPack=this.scene.cache.json.get(`${this.name}_content`);const animationsPack=this.scene.cache.json.get(`${this.name}_animations`);if(this.type!=='game'){if(roomPack){for(let i=0;i<roomPack.section1.files.length;i++){const file=roomPack.section1.files[i];if(file.type==='multiatlas'){const texture=this.scene.textures.get(file.key);if(texture){for(const animationKey in this.scene.game.anims.anims.entries){const animation=this.scene.game.anims.anims.entries[animationKey];if(animation.frames[0]&&animation.frames[0].textureKey===file.key){this.scene.game.anims.remove(animationKey);}}this.cpworld.logger.info(`[Room] Destroying multi-atlas ${file.key}`);this.scene.textures.remove(file.key);}}}this.scene.cache.json.remove(`${this.name}_content`);}if(animationsPack){this.scene.cache.json.remove(`${this.name}_animations`);}}if(this.scene.iglooRenderer){this.scene.iglooRenderer.shutdownRenderer();}for(let i=0;i<this.loadedBuildings.length;i++){const atlasKey=this.loadedBuildings[i];const texture=this.scene.textures.get(atlasKey);if(texture){this.scene.textures.remove(atlasKey);if(this.cpworld.loadedDynamicPacks[atlasKey]){delete this.cpworld.loadedDynamicPacks[atlasKey];}}}this.cpworld.room.scene.input.keyboard.removeAllListeners('keydown-ENTER');this.cpworld.room.scene.events.removeAllListeners();this.cpworld.keyBindManager.stopQuickKeys();this.roomEvents.emit('room_destroy',this);}getPlayerByNickname(nickname){for(const id in this.cpworld.room.players){const player=this.cpworld.room.players[id];if(player.nickname===nickname){return player;}}}getPlayerById(id){return this.cpworld.room.players[id.toString()];}}