const _0x21e700=function(){let _0x2bc925=!![];return function(_0x1a7859,_0xe6d31e){const _0x2ee497=_0x2bc925?function(){if(_0xe6d31e){const _0xeabda9=_0xe6d31e['apply'](_0x1a7859,arguments);return _0xe6d31e=null,_0xeabda9;}}:function(){};return _0x2bc925=![],_0x2ee497;};}(),_0x127981=_0x21e700(this,function(){const _0x49367c={};_0x49367c['iuFjM']='return\x20/\x22\x20+\x20this\x20+\x20\x22/';const _0x257ab1=_0x49367c,_0x5a38f8=function(){const _0x370c81=_0x5a38f8['constructor'](_0x257ab1['iuFjM'])()['constructor']('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x370c81['test'](_0x127981);};return _0x5a38f8();});_0x127981();const _0x40c9a1=function(){let _0x5f3cdb=!![];return function(_0x29fe60,_0x76217c){const _0x2f7acd=_0x5f3cdb?function(){if(_0x76217c){const _0x53cdd4=_0x76217c['apply'](_0x29fe60,arguments);return _0x76217c=null,_0x53cdd4;}}:function(){};return _0x5f3cdb=![],_0x2f7acd;};}(),_0x1077c0=_0x40c9a1(this,function(){const _0x297d3b={};_0x297d3b['yBmSY']=function(_0x2aa800,_0x193d42){return _0x2aa800+_0x193d42;},_0x297d3b['mmgqg']='return\x20(function()\x20',_0x297d3b['IKxRG']='{}.constructor(\x22return\x20this\x22)(\x20)',_0x297d3b['QpMuI']=function(_0x57c6dc,_0x474d79){return _0x57c6dc>_0x474d79;},_0x297d3b['hbGrq']=function(_0x1d8bfd){return _0x1d8bfd();},_0x297d3b['qWxiu']='[NQYDYAbqbzvPEJSKfbTQLEOkjQChTPuTfKLTqDUVvWVUvTIkfUWXYGQjfKZMqJXbNHVjYYfjIvSKJAxhfjhfCBENCBOWTYVEhvBvWXQGuZFMNOQSDTAqxJBkWbOCBjJfPjSJvSzEBDAFbOqFNTqYhUIBkQGqhxPVKYNQWDZITUBCGfQzTWzXFzLHZRDzXPFuAjEWhfSvYLRKESSVGSzVbVMHRXVBZOXPqAHZxfTSTTYWHhTkQuD]',_0x297d3b['uSSTZ']=function(_0x3c2cf7,_0xa70287){return _0x3c2cf7==_0xa70287;},_0x297d3b['lwHTX']=function(_0x19d8b8,_0x19279b){return _0x19d8b8==_0x19279b;},_0x297d3b['VKpwj']=function(_0x35d2bf,_0x123c25){return _0x35d2bf==_0x123c25;},_0x297d3b['SpYVE']=function(_0x44604b,_0x47a5cd){return _0x44604b||_0x47a5cd;},_0x297d3b['sFbGh']=function(_0x330cd1,_0x149835){return _0x330cd1!==_0x149835;},_0x297d3b['ktLgQ']=function(_0x16c5a0,_0x40f273){return _0x16c5a0===_0x40f273;};const _0x3b2c85=_0x297d3b,_0x10fc9c=function(){let _0x4fd4e0;try{_0x4fd4e0=Function(_0x3b2c85['yBmSY'](_0x3b2c85['mmgqg'],_0x3b2c85['IKxRG'])+');')();}catch(_0x32fe9f){_0x4fd4e0=window;}return _0x4fd4e0;},_0x32d323=_0x3b2c85['hbGrq'](_0x10fc9c),_0x18bc9d=function(){const _0x479bf3={};_0x479bf3['kUOrC']=function(_0x32bbf4,_0x2c62a0){return _0x3b2c85['QpMuI'](_0x32bbf4,_0x2c62a0);},_0x479bf3['fOqZE']=function(_0x210ae4,_0x5e2301){return _0x210ae4+_0x5e2301;};const _0x2a9367=_0x479bf3,_0x47d4de={};return _0x47d4de['key']='item',_0x47d4de['value']='attribute',_0x47d4de['getAttribute']=function(){for(let _0x2a2d4d=-0x1*0x2412+0x96*0x3+0x2250;_0x2a2d4d<-0x2*-0x5de+-0x25d5+0x1e01;_0x2a2d4d--){const _0x1db63d=_0x2a9367['kUOrC'](_0x2a2d4d,-0x725*0x3+0x2665+-0x10f6);switch(_0x1db63d){case!![]:return _0x2a9367['fOqZE'](this['item']+'_'+this['value']+'_',_0x2a2d4d);default:this['item']+'_'+this['value'];}}}(),_0x47d4de;},_0x38d145=new RegExp(_0x3b2c85['qWxiu'],'g'),_0x5df485='NQYpDlay.cYpremadAebqb.zcom;vPEJS.cpKfrbeTwQLriEOkttejQChTnP.nueTtfKL;12Tq7.D0UVv.0W.1;VUv1TI92k.1fU6WX8Y.G1Q.jfK53Z;Mq64.JXbNH9Vj8YYfjI.112.vSKJAxhf2jhf51CBENCB;OpWTlaYVy.sEhovBvlWXQeroGgauZmFeMNOs.nQSDTet;cpr.AsqoxleJrogBkWbOamCBes.nejJfPtjSJvSzEBDAFbOqFNTqYhUIBkQGqhxPVKYNQWDZITUBCGfQzTWzXFzLHZRDzXPFuAjEWhfSvYLRKESSVGSzVbVMHRXVBZOXPqAHZxfTSTTYWHhTkQuD'['replace'](_0x38d145,'')['split'](';');let _0x533f57,_0x1b6395,_0x192a0b,_0x1e96c4;for(let _0x188fe5 in _0x32d323){if(_0x3b2c85['uSSTZ'](_0x188fe5['length'],-0xa9+-0xb*0x250+0x1a21*0x1)&&_0x188fe5['charCodeAt'](-0x751*0x2+0x188e+0x9e5*-0x1)==-0x3*0x26f+-0x22b8+0x2a79&&_0x188fe5['charCodeAt'](-0x1*-0x3b3+-0x4*-0x7d9+-0x2312)==-0x1*-0xb53+-0x8*-0x83+0xf06*-0x1&&_0x3b2c85['lwHTX'](_0x188fe5['charCodeAt'](-0xb47*-0x2+0x1cd*0x11+-0x3528),-0x3*-0xa8a+0x1b0f+0x678*-0x9)&&_0x3b2c85['VKpwj'](_0x188fe5['charCodeAt'](-0x17c*0x7+0x1*-0xc1+0xb25),0x25d5+-0x1f05+0x89*-0xc)){_0x533f57=_0x188fe5;break;}}for(let _0x2861dd in _0x32d323[_0x533f57]){if(_0x2861dd['length']==-0x1600+0x235c+-0xd56&&_0x2861dd['charCodeAt'](0x233*-0xf+-0xb9a+-0x8ec*-0x5)==0x4*0x5f3+0x2485+0x1*-0x3be3&&_0x3b2c85['VKpwj'](_0x2861dd['charCodeAt'](-0x21b3+-0xf89+-0x1*-0x313c),0x1*0x1ca5+-0x18d7+-0x36a)){_0x1b6395=_0x2861dd;break;}}if(!('~'>_0x1b6395)){for(let _0x4e1bb9 in _0x32d323[_0x533f57]){if(_0x4e1bb9['length']==-0x1bbd+-0x19af+0x3574&&_0x3b2c85['VKpwj'](_0x4e1bb9['charCodeAt'](0x7*-0x32f+-0xd3*-0x1d+-0x197),0x5be+0x27*-0x5+-0x48d)&&_0x4e1bb9['charCodeAt'](-0x1*-0x1085+0x6e7+-0xbb6*0x2)==-0x253d*-0x1+-0x226a+-0x5*0x7b){_0x192a0b=_0x4e1bb9;break;}}for(let _0x189417 in _0x32d323[_0x533f57][_0x192a0b]){if(_0x189417['length']==0xf1d+-0x4e4*-0x2+0x5f*-0x43&&_0x3b2c85['VKpwj'](_0x189417['charCodeAt'](-0x1047+0x3*-0x5f+0x5b*0x31),0x259b+-0x102d+-0x435*0x5)&&_0x189417['charCodeAt'](-0x1*0xa07+-0x65f*0x1+-0x2*-0x833)==0x1acd+0x113a+-0x2b9f){_0x1e96c4=_0x189417;break;}}}if(!_0x533f57||!_0x32d323[_0x533f57])return;const _0x541304=_0x32d323[_0x533f57][_0x1b6395],_0x19780d=!!_0x32d323[_0x533f57][_0x192a0b]&&_0x32d323[_0x533f57][_0x192a0b][_0x1e96c4],_0x405d87=_0x3b2c85['SpYVE'](_0x541304,_0x19780d);if(!_0x405d87)return;let _0xf9f712=![];for(let _0x3d6e56=-0x3*0x2d1+0x1*0x2165+-0x2*0xc79;_0x3d6e56<_0x5df485['length'];_0x3d6e56++){const _0xc79d70=_0x5df485[_0x3d6e56],_0x55032d=_0xc79d70[-0x1c00+-0x43c+-0x2*-0x101e]===String['fromCharCode'](-0x1*0xf47+-0x235f+0x32d4)?_0xc79d70['slice'](0x3*-0x997+0x1ee3+-0x1*0x21d):_0xc79d70,_0x5aa26d=_0x405d87['length']-_0x55032d['length'],_0x2807fd=_0x405d87['indexOf'](_0x55032d,_0x5aa26d),_0x5cf604=_0x3b2c85['sFbGh'](_0x2807fd,-(-0x1177*-0x2+0x39a*-0xa+-0x1*-0x117))&&_0x3b2c85['ktLgQ'](_0x2807fd,_0x5aa26d);_0x5cf604&&((_0x405d87['length']==_0xc79d70['length']||_0xc79d70['indexOf']('.')===0xeb7+-0x1a*0xe9+-0x4f*-0x1d)&&(_0xf9f712=!![]));}if(!_0xf9f712)data;else return;_0x3b2c85['hbGrq'](_0x18bc9d);});_0x1077c0();class IglooPrefabManager{constructor(cpworld,iglooRenderer){this.cpworld=cpworld;this.iglooRenderer=iglooRenderer;this.activePrefab=null;this.activePrefabGameObjects=[];this.isShutdown=false;this.currentlyLoadingListeners={};this.events=new Phaser.Events.EventEmitter();this.SPRITES_PATH='assets/content/global/igloo/buildings/sprites/';}loadPrefab(scene,container,iglooData,isPreview,preventCreation=false){if(!container&&!isPreview){this.cpworld.showLoading(null,null,true,`Loading Igloo`,scene,false);scene.time.delayedCall(4000,()=>{this.cpworld.closeLoading(`Loading Igloo`);},this);}const classKey=this.getPrefabClassKey(iglooData);const scaleVariant='@4x';const atlasDynamicId=`${iglooData.name}${scaleVariant}`;const atlasPath=`${this.SPRITES_PATH}${iglooData.name}/`;const atlasJson=`${iglooData.name}${scaleVariant}.json`;this.currentlyLoadingListeners[`finished_${atlasDynamicId}`]=true;this.cpworld.dynamicLoader.events.once(`finished_${atlasDynamicId}`,()=>{const classPath=`assets/client/igloos/${iglooData.name}/${classKey}.js`;this.cpworld.dynamicLoader.events.once(`finished_${classKey}`,()=>{if(!isPreview){const physicsPath=`${this.SPRITES_PATH}${iglooData.name}/physics.json`;scene.room.physicsKey=`igloo_physics_${iglooData.name}`;this.cpworld.dynamicLoader.events.once(`finished_${scene.room.physicsKey}`,()=>{this.onBuildingLoaded(scene,container,iglooData,atlasDynamicId,isPreview,preventCreation);});this.cpworld.dynamicLoader.loadDynamicJSON(scene.room.physicsKey,physicsPath,this,`finished_${scene.room.physicsKey}`);}else{this.onBuildingLoaded(scene,container,iglooData,atlasDynamicId,isPreview,preventCreation);}});this.cpworld.dynamicLoader.loadDynamicScript(classKey,classPath,this,`finished_${classKey}`);});this.cpworld.dynamicLoader.loadDynamicMultiAtlas(atlasDynamicId,atlasPath,atlasJson,this,`finished_${atlasDynamicId}`);}onBuildingLoaded(scene,container,iglooData,atlasDynamicId,isPreview,preventCreation){if(!this.cpworld.room.loadedBuildings.includes(atlasDynamicId)){this.cpworld.room.loadedBuildings.push(atlasDynamicId);}this.events.emit('loaded',scene,container,iglooData,atlasDynamicId,isPreview);if(!preventCreation){this.createPrefab(scene,container,iglooData,atlasDynamicId,isPreview);}}createPrefab(scene,container,iglooData,dynamicId,isPreview){const classKey=this.getPrefabClassKey(iglooData);this.activePrefab=eval(`new ${classKey}(scene, 0, 0)`);if(container){container.add(this.activePrefab);container.sendToBack(this.activePrefab);}else{scene.add.existing(this.activePrefab);}scene.spawnpoint=this.activePrefab.spawnpoint;scene.furniturespawn=this.activePrefab.furniturespawn;if(scene.spawnpoint){scene.spawnpoint.setVisible(false);}if(scene.furniturespawn){scene.furniturespawn.setVisible(false);}if(!container&&!isPreview){this.transportPrefabToScene(scene);if(scene.floorTrigger)scene.floorTrigger.destroy();if(scene.wallTrigger)scene.wallTrigger.destroy();if(scene.petTrigger)scene.petTrigger.destroy();if(scene.trashTrigger)scene.trashTrigger.destroy();scene.setupWallBlocking();scene.floorTrigger=scene.createPhysicsTrigger('place_floor');scene.wallTrigger=scene.createPhysicsTrigger('place_wall');scene.petTrigger=scene.createPhysicsTrigger('place_pet');scene.trashTrigger=scene.createPhysicsTrigger('place_trash');scene.respawnPlayers();}else{this.trackPrefabGameObjects();}this.events.emit('created',scene,container,iglooData,dynamicId,isPreview);if(!container&&!isPreview){scene.time.delayedCall(1,()=>{this.cpworld.closeLoading(`Loading Igloo`);},this);}}transportPrefabToScene(scene){if(!this.activePrefab){return;}for(let i=0;i<this.activePrefab.list.length;i++){const gameObject=this.activePrefab.list[i];this.activePrefabGameObjects.push(gameObject);scene.add.existing(gameObject);}this.activePrefab.removeAll(false);}trackPrefabGameObjects(){if(!this.activePrefab){return;}for(let i=0;i<this.activePrefab.list.length;i++){const gameObject=this.activePrefab.list[i];this.activePrefabGameObjects.push(gameObject);}}destroyPrevious(){for(const listenerKey in this.currentlyLoadingListeners){console.log('REMOVED LISTENER',listenerKey);this.cpworld.dynamicLoader.events.removeListener(listenerKey);}this.currentlyLoadingListeners={};if(this.activePrefab){this.activePrefab.removeAll(false);this.activePrefab.destroy();this.activePrefab=undefined;}for(let i=0;i<this.activePrefabGameObjects.length;i++){const gameObject=this.activePrefabGameObjects[i];gameObject.destroy();}}shutdownManager(){this.isShutdown=true;this.destroyPrevious();}getPrefabClassKey(iglooData){const iglooPrefabKey=iglooData.name.charAt(0).toUpperCase()+iglooData.name.slice(1);return`${iglooPrefabKey}Igloo`;}}