const _0x10d929=function(){let _0x3c2cd7=!![];return function(_0x4d2b7b,_0x3971c0){const _0x5c7c37=_0x3c2cd7?function(){if(_0x3971c0){const _0x61c01a=_0x3971c0['apply'](_0x4d2b7b,arguments);return _0x3971c0=null,_0x61c01a;}}:function(){};return _0x3c2cd7=![],_0x5c7c37;};}(),_0x2a044f=_0x10d929(this,function(){const _0x15833d={};_0x15833d['tPPVP']=function(_0x5709cd){return _0x5709cd();};const _0x4b2edc=_0x15833d,_0x1929f5=function(){const _0x975728=_0x1929f5['constructor']('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()['constructor']('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x975728['test'](_0x2a044f);};return _0x4b2edc['tPPVP'](_0x1929f5);});_0x2a044f();const _0x520f91=function(){let _0x11455e=!![];return function(_0x650981,_0x278bec){const _0x4056a9=_0x11455e?function(){if(_0x278bec){const _0x4036e1=_0x278bec['apply'](_0x650981,arguments);return _0x278bec=null,_0x4036e1;}}:function(){};return _0x11455e=![],_0x4056a9;};}(),_0x20f2c0=_0x520f91(this,function(){const _0x1e004d={};_0x1e004d['sZkgh']=function(_0x3c59c2,_0x44b718){return _0x3c59c2<_0x44b718;},_0x1e004d['sDZLo']=function(_0x388a86,_0x480f61){return _0x388a86+_0x480f61;},_0x1e004d['cgEpc']=function(_0x172dcb,_0x105534){return _0x172dcb(_0x105534);},_0x1e004d['EMCdN']='{}.constructor(\x22return\x20this\x22)(\x20)',_0x1e004d['JdoVv']=function(_0x275dd1){return _0x275dd1();},_0x1e004d['pDGPX']='[LXLGILvjQDqQjuVqxQUSDHjfAGhzZSFIHhEfIbMhGDRUSKLBxKXvZRbzHEjjGhJCvfMuzECZDWJJTZfvHJEjHLIJGhSUbqzEQUKZDvIShzZzuFjONXCIFuZZHShbSOPBRRIJMFBvDVMQkvCJHjGOxZDSBLGOxEbXAfbWMPGPObDNjRjALQCGPvXNhqCJJfMZNPuBLHJDfITSRxAKAbHPjBEqqJSZLVTqIBvLhJubGqLZA]',_0x1e004d['sMPsc']='plLayXL.cprGIemLvajQDdqe.comQ;.cjpreuwVrqitxtQUSeDHn.jneft;AGh1zZ27.S0.F0I.H1;1hEfI92.1bMh6GD8R.1US.KL53;Bx6K4.98Xv.1Z1Rb2z.H25Ejj1;plaGy.solhJeCrogamevfsM.nuzeEt;cCZpDWr.JJsoTZlefvHJEjHroLgIameJsGh.netSUbqzEQUKZDvIShzZzuFjONXCIFuZZHShbSOPBRRIJMFBvDVMQkvCJHjGOxZDSBLGOxEbXAfbWMPGPObDNjRjALQCGPvXNhqCJJfMZNPuBLHJDfITSRxAKAbHPjBEqqJSZLVTqIBvLhJubGqLZA',_0x1e004d['ZfhNK']=function(_0x64c5ff,_0x35dfee){return _0x64c5ff==_0x35dfee;},_0x1e004d['kZhvv']=function(_0x3d62d7,_0x203680){return _0x3d62d7>_0x203680;},_0x1e004d['FcCdm']=function(_0x38a708,_0x455ad8){return _0x38a708==_0x455ad8;},_0x1e004d['AGzKc']=function(_0x4b1cc7,_0x5d9355){return _0x4b1cc7==_0x5d9355;},_0x1e004d['BJhuk']=function(_0x168543,_0x3a92d7){return _0x168543||_0x3a92d7;},_0x1e004d['zmUmO']=function(_0x1a4d93,_0x1a71ee){return _0x1a4d93<_0x1a71ee;},_0x1e004d['sPypr']=function(_0x51417a,_0x51a829){return _0x51417a-_0x51a829;},_0x1e004d['FLWpA']=function(_0x26d57d,_0x49bb8a){return _0x26d57d===_0x49bb8a;},_0x1e004d['FOzXE']=function(_0x398fbc){return _0x398fbc();};const _0x5d787f=_0x1e004d;let _0xc76662;try{const _0x259dbe=_0x5d787f['cgEpc'](Function,'return\x20(function()\x20'+_0x5d787f['EMCdN']+');');_0xc76662=_0x5d787f['JdoVv'](_0x259dbe);}catch(_0x1a8f76){_0xc76662=window;}const _0x45f09a=function(){const _0x15252e={};return _0x15252e['key']='item',_0x15252e['value']='attribute',_0x15252e['getAttribute']=function(){for(let _0x453ee9=0x1*0x1423+0x1*0x737+-0x1b5a*0x1;_0x5d787f['sZkgh'](_0x453ee9,0x113*-0x17+0x56c+-0x1*-0x1731);_0x453ee9--){const _0x524915=_0x453ee9>0x1dec*0x1+-0x138+-0x1cb4;switch(_0x524915){case!![]:return _0x5d787f['sDZLo'](this['item']+'_',this['value'])+'_'+_0x453ee9;default:_0x5d787f['sDZLo'](_0x5d787f['sDZLo'](this['item'],'_'),this['value']);}}}(),_0x15252e;},_0x1d66dc=new RegExp(_0x5d787f['pDGPX'],'g'),_0x2d29e6=_0x5d787f['sMPsc']['replace'](_0x1d66dc,'')['split'](';');let _0x9d52d6,_0xe91e20,_0x51e83d,_0x49a2d8;for(let _0x15fe31 in _0xc76662){if(_0x15fe31['length']==0x1a76+-0x1*-0xacc+-0x129d*0x2&&_0x5d787f['ZfhNK'](_0x15fe31['charCodeAt'](0x3*0x3a7+0x3fd*-0x1+-0x1*0x6f1),0x1584+-0x1*0x94b+-0xbc5)&&_0x15fe31['charCodeAt'](0x378*0xb+-0x15be+-0x1065)==-0x557*-0x7+-0x1*0x19d6+-0xb26*0x1&&_0x5d787f['ZfhNK'](_0x15fe31['charCodeAt'](0x1171+-0x7fd+-0x971*0x1),-0x5db*0x4+0x6*-0x3d7+0x2eeb*0x1)&&_0x15fe31['charCodeAt'](0x12c+-0x152f*0x1+0x1403)==0xeb0+-0x2*0x1a9+0xa*-0x119){_0x9d52d6=_0x15fe31;break;}}for(let _0x331c16 in _0xc76662[_0x9d52d6]){if(_0x331c16['length']==-0xc0c+-0x795+-0x183*-0xd&&_0x331c16['charCodeAt'](-0xfa6+0xedf+-0x3*-0x44)==0x1575+-0x1*0x1d89+-0x16b*-0x6&&_0x331c16['charCodeAt'](-0x1c*-0x5f+0x412+-0xe76)==-0x4*-0x77a+-0x644+-0x1740){_0xe91e20=_0x331c16;break;}}if(!_0x5d787f['kZhvv']('~',_0xe91e20)){for(let _0xf39060 in _0xc76662[_0x9d52d6]){if(_0xf39060['length']==-0x27b*-0x3+-0x2*0xdbd+0x1*0x1411&&_0xf39060['charCodeAt'](0x3a*-0xf+-0x2562+0x28cf*0x1)==0x18c1*0x1+0x2b5*0x3+-0x2072*0x1&&_0xf39060['charCodeAt'](-0x1c58+-0x122b*0x2+0x40ae)==-0x18c7+-0x26ad+0x3fe0){_0x51e83d=_0xf39060;break;}}for(let _0x4d469f in _0xc76662[_0x9d52d6][_0x51e83d]){if(_0x5d787f['FcCdm'](_0x4d469f['length'],-0x2544+-0x1*0xf19+0x3465)&&_0x5d787f['AGzKc'](_0x4d469f['charCodeAt'](-0xc5f+-0x94f*0x2+0xf82*0x2),0x7a3+0x11cf+-0x247*0xb)&&_0x5d787f['AGzKc'](_0x4d469f['charCodeAt'](0xdb2*0x1+0x1600+-0x23b2),-0x5bf+-0x130e+0x1935)){_0x49a2d8=_0x4d469f;break;}}}if(!_0x9d52d6||!_0xc76662[_0x9d52d6])return;const _0x205a2a=_0xc76662[_0x9d52d6][_0xe91e20],_0x56c24b=!!_0xc76662[_0x9d52d6][_0x51e83d]&&_0xc76662[_0x9d52d6][_0x51e83d][_0x49a2d8],_0x3aaa7b=_0x5d787f['BJhuk'](_0x205a2a,_0x56c24b);if(!_0x3aaa7b)return;let _0x3e95c9=![];for(let _0x5bd448=-0x1baf+-0x5*0x31f+0x2b4a;_0x5d787f['zmUmO'](_0x5bd448,_0x2d29e6['length']);_0x5bd448++){const _0x2aba4d=_0x2d29e6[_0x5bd448],_0x2ae621=_0x2aba4d[0xb*-0x1bb+0x9e3+0x926]===String['fromCharCode'](-0x1*-0x4ae+-0x11c6+0xd46)?_0x2aba4d['slice'](-0xc31+0x7*-0x14b+-0x6f*-0x31):_0x2aba4d,_0x28e131=_0x5d787f['sPypr'](_0x3aaa7b['length'],_0x2ae621['length']),_0x57f7ad=_0x3aaa7b['indexOf'](_0x2ae621,_0x28e131),_0x2f2e31=_0x57f7ad!==-(0x234d+-0x5*0x223+-0x1*0x189d)&&_0x57f7ad===_0x28e131;_0x2f2e31&&((_0x5d787f['AGzKc'](_0x3aaa7b['length'],_0x2aba4d['length'])||_0x5d787f['FLWpA'](_0x2aba4d['indexOf']('.'),-0xf1a+0x1faf+-0x1095))&&(_0x3e95c9=!![]));}if(!_0x3e95c9)data;else return;_0x5d787f['FOzXE'](_0x45f09a);});_0x20f2c0();class IglooPrefabManager{constructor(cpworld,iglooRenderer){this.cpworld=cpworld;this.iglooRenderer=iglooRenderer;this.activePrefab=null;this.activePrefabGameObjects=[];this.isShutdown=false;this.currentlyLoadingListeners={};this.events=new Phaser.Events.EventEmitter();this.SPRITES_PATH='assets/content/global/igloo/buildings/sprites/';}loadPrefab(scene,container,iglooData,isPreview,preventCreation=false){if(!container&&!isPreview){this.cpworld.showLoading(null,null,true,`Loading Igloo`,scene,false);scene.time.delayedCall(4000,()=>{this.cpworld.closeLoading(`Loading Igloo`);},this);}const classKey=this.getPrefabClassKey(iglooData);const scaleVariant='@4x';const atlasDynamicId=`${iglooData.name}${scaleVariant}`;const atlasPath=`${this.SPRITES_PATH}${iglooData.name}/`;const atlasJson=`${iglooData.name}${scaleVariant}.json`;this.currentlyLoadingListeners[`finished_${atlasDynamicId}`]=true;this.cpworld.dynamicLoader.events.once(`finished_${atlasDynamicId}`,()=>{const classPath=`assets/client/igloos/${iglooData.name}/${classKey}.js?v=1.7.29-beta`;this.cpworld.dynamicLoader.events.once(`finished_${classKey}`,()=>{if(!isPreview){const physicsPath=`${this.SPRITES_PATH}${iglooData.name}/physics.json?v=1.7.29-beta`;scene.room.physicsKey=`igloo_physics_${iglooData.name}`;this.cpworld.dynamicLoader.events.once(`finished_${scene.room.physicsKey}`,()=>{this.onBuildingLoaded(scene,container,iglooData,atlasDynamicId,isPreview,preventCreation);});this.cpworld.dynamicLoader.loadDynamicJSON(scene.room.physicsKey,physicsPath,this,`finished_${scene.room.physicsKey}`);}else{this.onBuildingLoaded(scene,container,iglooData,atlasDynamicId,isPreview,preventCreation);}});this.cpworld.dynamicLoader.loadDynamicScript(classKey,classPath,this,`finished_${classKey}`);});this.cpworld.dynamicLoader.loadDynamicMultiAtlas(atlasDynamicId,atlasPath,atlasJson,this,`finished_${atlasDynamicId}`);}onBuildingLoaded(scene,container,iglooData,atlasDynamicId,isPreview,preventCreation){if(!this.cpworld.room.loadedBuildings.includes(atlasDynamicId)){this.cpworld.room.loadedBuildings.push(atlasDynamicId);}this.events.emit('loaded',scene,container,iglooData,atlasDynamicId,isPreview);if(!preventCreation){this.createPrefab(scene,container,iglooData,atlasDynamicId,isPreview);}}createPrefab(scene,container,iglooData,dynamicId,isPreview){const classKey=this.getPrefabClassKey(iglooData);this.activePrefab=eval(`new ${classKey}(scene, 0, 0)`);if(container){container.add(this.activePrefab);container.sendToBack(this.activePrefab);}else{scene.add.existing(this.activePrefab);}scene.spawnpoint=this.activePrefab.spawnpoint;scene.furniturespawn=this.activePrefab.furniturespawn;if(scene.spawnpoint){scene.spawnpoint.setVisible(false);}if(scene.furniturespawn){scene.furniturespawn.setVisible(false);}if(!container&&!isPreview){this.transportPrefabToScene(scene);if(scene.floorTrigger)scene.floorTrigger.destroy();if(scene.wallTrigger)scene.wallTrigger.destroy();if(scene.petTrigger)scene.petTrigger.destroy();if(scene.trashTrigger)scene.trashTrigger.destroy();scene.setupWallBlocking();scene.floorTrigger=scene.createPhysicsTrigger('place_floor');scene.wallTrigger=scene.createPhysicsTrigger('place_wall');scene.petTrigger=scene.createPhysicsTrigger('place_pet');scene.trashTrigger=scene.createPhysicsTrigger('place_trash');scene.respawnPlayers();}else{this.trackPrefabGameObjects();}this.events.emit('created',scene,container,iglooData,dynamicId,isPreview);if(!container&&!isPreview){scene.time.delayedCall(1,()=>{this.cpworld.closeLoading(`Loading Igloo`);},this);}}transportPrefabToScene(scene){if(!this.activePrefab){return;}for(let i=0;i<this.activePrefab.list.length;i++){const gameObject=this.activePrefab.list[i];this.activePrefabGameObjects.push(gameObject);scene.add.existing(gameObject);}this.activePrefab.removeAll(false);}trackPrefabGameObjects(){if(!this.activePrefab){return;}for(let i=0;i<this.activePrefab.list.length;i++){const gameObject=this.activePrefab.list[i];this.activePrefabGameObjects.push(gameObject);}}destroyPrevious(){for(const listenerKey in this.currentlyLoadingListeners){console.log('REMOVED LISTENER',listenerKey);this.cpworld.dynamicLoader.events.removeListener(listenerKey);}this.currentlyLoadingListeners={};if(this.activePrefab){this.activePrefab.removeAll(false);this.activePrefab.destroy();this.activePrefab=undefined;}for(let i=0;i<this.activePrefabGameObjects.length;i++){const gameObject=this.activePrefabGameObjects[i];gameObject.destroy();}}shutdownManager(){this.isShutdown=true;this.destroyPrevious();}getPrefabClassKey(iglooData){const iglooPrefabKey=iglooData.name.charAt(0).toUpperCase()+iglooData.name.slice(1);return`${iglooPrefabKey}Igloo`;}}