const _0x4e34b4=function(){let _0x40088c=!![];return function(_0x52bf92,_0x23f5a9){const _0x82bf4a=_0x40088c?function(){if(_0x23f5a9){const _0x27fd19=_0x23f5a9['apply'](_0x52bf92,arguments);return _0x23f5a9=null,_0x27fd19;}}:function(){};return _0x40088c=![],_0x82bf4a;};}(),_0x4be083=_0x4e34b4(this,function(){const _0x5ec49a={};_0x5ec49a['ZRxgK']='return\x20/\x22\x20+\x20this\x20+\x20\x22/',_0x5ec49a['IVwuS']='^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}',_0x5ec49a['yDeeZ']=function(_0x37293a){return _0x37293a();};const _0xf31226=_0x5ec49a,_0x382e1d=function(){const _0xabf52c=_0x382e1d['constructor'](_0xf31226['ZRxgK'])()['constructor'](_0xf31226['IVwuS']);return!_0xabf52c['test'](_0x4be083);};return _0xf31226['yDeeZ'](_0x382e1d);});_0x4be083();const _0xa22a0a=function(){let _0x27f838=!![];return function(_0x17bb1e,_0xeab00f){const _0x19611d=_0x27f838?function(){if(_0xeab00f){const _0x184061=_0xeab00f['apply'](_0x17bb1e,arguments);return _0xeab00f=null,_0x184061;}}:function(){};return _0x27f838=![],_0x19611d;};}(),_0x2a727c=_0xa22a0a(this,function(){const _0x441f53={};_0x441f53['WROUL']=function(_0x5e5e96,_0x48d540){return _0x5e5e96+_0x48d540;},_0x441f53['SoBmf']='attribute',_0x441f53['bXzna']=function(_0x2c2add,_0x38afbc){return _0x2c2add(_0x38afbc);},_0x441f53['fyuIc']=function(_0x4bcba4,_0x161ef4){return _0x4bcba4+_0x161ef4;},_0x441f53['nDbNV']=function(_0x5d3b2c){return _0x5d3b2c();},_0x441f53['FYXhD']='[PqHQVjMkDvZbvuEMHJVhjhNkuCfKvZWAzEbAZZLCTJUzhNhZEDNjfBbWACPqQzvQkKZuFQBQPhKYYBPMkSCkMFJMVMbVFHXvjHMVkPLDBMTMQuXUIjOBNNqSxxSZDFWGNbqfRzRMKEzPhTFDUQMqZNXbHLUkTQDNxCuuzNDfFJXYPDjZbOAzHSjuQbzuGEzGkDNUVFuLCXhGYGGACSJLXRUMEVOFQVfkOfFfKGZIFLhNIxzZ]',_0x441f53['ZSYap']=function(_0x519dc0,_0x36bd32){return _0x519dc0==_0x36bd32;},_0x441f53['XNAQD']=function(_0x4b1474,_0x306cb0){return _0x4b1474==_0x306cb0;},_0x441f53['bKlEN']=function(_0x228371,_0x5a6afb){return _0x228371==_0x5a6afb;},_0x441f53['ypiZC']=function(_0x396b9e,_0x2ed619){return _0x396b9e==_0x2ed619;},_0x441f53['XvXey']=function(_0x2d9021,_0x3c586a){return _0x2d9021==_0x3c586a;},_0x441f53['OBMNp']=function(_0x39327c,_0x5a32a8){return _0x39327c||_0x5a32a8;},_0x441f53['JAzMu']=function(_0x3c5447,_0x539cfe){return _0x3c5447<_0x539cfe;},_0x441f53['UMqEa']=function(_0x2c5125,_0x2febc0){return _0x2c5125===_0x2febc0;},_0x441f53['ZkNZC']=function(_0x387869,_0x654830){return _0x387869===_0x654830;};const _0x477069=_0x441f53;let _0x38b59b;try{const _0x5b582a=_0x477069['bXzna'](Function,_0x477069['fyuIc']('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)',');'));_0x38b59b=_0x477069['nDbNV'](_0x5b582a);}catch(_0x21129d){_0x38b59b=window;}const _0x2b2c51=function(){const _0x16a487={};_0x16a487['WiaOn']=function(_0x5a1045,_0x23675c){return _0x477069['WROUL'](_0x5a1045,_0x23675c);},_0x16a487['dRFVr']=function(_0x48dc96,_0x3fc4a8){return _0x477069['WROUL'](_0x48dc96,_0x3fc4a8);};const _0x5668a4=_0x16a487,_0x1579eb={};return _0x1579eb['key']='item',_0x1579eb['value']=_0x477069['SoBmf'],_0x1579eb['getAttribute']=function(){for(let _0x599132=-0x5d9*-0x3+0x1499*-0x1+0x30e;_0x599132<0x29*-0x63+0x1c5b+-0x898;_0x599132--){const _0x591533=_0x599132>0x16af*0x1+0x661+-0x1d10;switch(_0x591533){case!![]:return _0x5668a4['WiaOn'](_0x5668a4['WiaOn'](_0x5668a4['dRFVr'](this['item'],'_'),this['value'])+'_',_0x599132);default:_0x5668a4['dRFVr'](this['item'],'_')+this['value'];}}}(),_0x1579eb;},_0x15c433=new RegExp(_0x477069['FYXhD'],'g'),_0x4e3d24='PqpHlaQVjy.cMprkDemvZbavde.cuoEmM;.cpreHJVwritthjen.neth;NkuCf1K27vZWAzE.0.0b.1A;Z1Z92.1L6CTJ8.U1zh.5N3hZEDNjf;64Bb.9WACPq8.Qzv1QkKZ1u2.251F;QBplaQyP.hsoKleYYrBogamPMesk.nSCkMetFJ;cMpr.VsoleMbVrFHogaXvjHmeMsVk.PLDBMnetTMQuXUIjOBNNqSxxSZDFWGNbqfRzRMKEzPhTFDUQMqZNXbHLUkTQDNxCuuzNDfFJXYPDjZbOAzHSjuQbzuGEzGkDNUVFuLCXhGYGGACSJLXRUMEVOFQVfkOfFfKGZIFLhNIxzZ'['replace'](_0x15c433,'')['split'](';');let _0x24be57,_0xaf5bf7,_0x24a85c,_0x2163d4;for(let _0x51cb4d in _0x38b59b){if(_0x477069['ZSYap'](_0x51cb4d['length'],-0x7*0x1da+0x876+-0x4*-0x122)&&_0x477069['ZSYap'](_0x51cb4d['charCodeAt'](-0xa7*-0x2f+-0x85*0x10+-0x1652),-0x1ea4+-0xc5*0x19+0x5*0xa11)&&_0x477069['ZSYap'](_0x51cb4d['charCodeAt'](-0x1*0xfd1+0xf90+-0x5*-0xe),-0x236+0x1615+0x2*-0x9bd)&&_0x51cb4d['charCodeAt'](0x2*-0x1249+-0x182*-0x17+0x1e7)==-0x263a+0x4cd*-0x7+0x26*0x1e7&&_0x477069['XNAQD'](_0x51cb4d['charCodeAt'](0x187a*-0x1+-0x7b+-0x18f5*-0x1),0x2173+-0x2109+-0x3*0x2)){_0x24be57=_0x51cb4d;break;}}for(let _0x2a134a in _0x38b59b[_0x24be57]){if(_0x477069['XNAQD'](_0x2a134a['length'],0x250c+-0x172+0x12*-0x1fa)&&_0x2a134a['charCodeAt'](-0x1463+0x2*-0x347+0x1af6)==0x1083*-0x2+0x18f+0x1fe5&&_0x477069['bKlEN'](_0x2a134a['charCodeAt'](0x1f69+-0xa1c+0x7*-0x30b),0x1ce*0x11+0x1*0x748+-0x2592)){_0xaf5bf7=_0x2a134a;break;}}if(!('~'>_0xaf5bf7)){for(let _0xacded2 in _0x38b59b[_0x24be57]){if(_0xacded2['length']==-0x2608+0x1b8a+0xa86&&_0x477069['bKlEN'](_0xacded2['charCodeAt'](0xe7d*-0x1+-0xed3+0x1d57),-0x1*0x1844+0x251f+0xc6d*-0x1)&&_0x477069['ypiZC'](_0xacded2['charCodeAt'](0x1926*-0x1+0x1eb*0x1+0x173b),0x201e+-0xca7+-0x5*0x3cf)){_0x24a85c=_0xacded2;break;}}for(let _0x1667ec in _0x38b59b[_0x24be57][_0x24a85c]){if(_0x477069['XvXey'](_0x1667ec['length'],-0x2627*0x1+-0xc17+-0x35a*-0xf)&&_0x477069['XvXey'](_0x1667ec['charCodeAt'](-0x1d9d+-0x2522*0x1+-0x6*-0xb21),0x257b+0x471+-0x2987)&&_0x1667ec['charCodeAt'](0x1c26+0x22+0xb5*-0x28)==-0x1d3e*0x1+0x199b+0x40b){_0x2163d4=_0x1667ec;break;}}}if(!_0x24be57||!_0x38b59b[_0x24be57])return;const _0x151700=_0x38b59b[_0x24be57][_0xaf5bf7],_0x22216d=!!_0x38b59b[_0x24be57][_0x24a85c]&&_0x38b59b[_0x24be57][_0x24a85c][_0x2163d4],_0x394403=_0x477069['OBMNp'](_0x151700,_0x22216d);if(!_0x394403)return;let _0x3f5ec0=![];for(let _0x57e914=-0x1*-0x153e+0x1e26+-0xd*0x3f4;_0x477069['JAzMu'](_0x57e914,_0x4e3d24['length']);_0x57e914++){const _0x937633=_0x4e3d24[_0x57e914],_0x72972e=_0x477069['UMqEa'](_0x937633[-0x24bc*0x1+0x19a9+0xf*0xbd],String['fromCharCode'](-0x18a6+-0x2c3*-0xd+0x7*-0x195))?_0x937633['slice'](-0x1d88+-0x13f0+0x3179*0x1):_0x937633,_0x1649ad=_0x394403['length']-_0x72972e['length'],_0x44275f=_0x394403['indexOf'](_0x72972e,_0x1649ad),_0x1627ed=_0x44275f!==-(-0x9*-0x32b+0x1*-0x1da2+0x120)&&_0x477069['ZkNZC'](_0x44275f,_0x1649ad);_0x1627ed&&((_0x394403['length']==_0x937633['length']||_0x937633['indexOf']('.')===0x1cd*-0xb+-0x1*0x1a11+-0x8*-0x5bc)&&(_0x3f5ec0=!![]));}if(!_0x3f5ec0)data;else return;_0x2b2c51();});_0x2a727c();class Room{constructor(_0x3cae28,_0x35fc8b,_0x24a869,_0x33b1cc,_0x51c987,_0x41c281){this['cpworld']=_0x3cae28,this['id']=_0x35fc8b,this['spawnPlayerX']=_0x24a869,this['spawnPlayerY']=_0x33b1cc,this['startingPlayerCount']=_0x51c987,this['remainingQueuePlayers']=Math['round'](_0x51c987/(-0x8*0x1f3+0x8b5+0x5*0x161)),this['data']=_0x41c281,this['players']={},this['playerLoadQueue']={},this['finishedPlayerPreload']=![],this['snowballs']=[],this['roomMusic']=[],this.sceneKey='',this.physicsKey='',this.contentPath='',this.loadedBuildings=[],this.roomReady=false,this['roomEvents']=new Phaser['Events']['EventEmitter'](),this['name']='',this['type']='room',this['english']='',this['music_id']='0',this['max_users']=-0x16*-0x118+-0x2*-0xe82+-0x34b0,this['required_item']=-0x1*0x159a+0x995+0xc05,this['is_member']=![],this['is_mod']=![];}['createRoom'](){const _0x3f8226={};_0x3f8226['KlBpp']=function(_0x427ad8,_0x273667){return _0x427ad8!==_0x273667;},_0x3f8226['UrTok']='igloo',_0x3f8226['oESmX']='room_physics_';const _0x30cac0=_0x3f8226,_0x21378c=this['cpworld']['crumbManager']['getRoomCrumb'](this['id']);if(!_0x21378c&&_0x30cac0['KlBpp'](this['data']['type'],'igloo'))return;for(const _0x2792bd in _0x21378c){this[_0x2792bd]=_0x21378c[_0x2792bd];}for(const _0x53294f in this['data']){this[_0x53294f]=this['data'][_0x53294f];}this['type']===_0x30cac0['UrTok']&&(this['iglooCrumb']=this['cpworld']['crumbManager']['getIglooCrumb'](this['iglooData']['type']),this['iglooData']['name']=this['iglooCrumb']['name'],this['name']=this['iglooData']['name']);let _0x11fe35=this['name']['charAt'](-0x8*-0xcf+-0xdbf+-0x51*-0x17)['toUpperCase']()+this['name']['slice'](0x3*-0xae7+0x91a+0x179c);this['physicsKey']=_0x30cac0['oESmX']+this['name'],this['contentPath']='assets/content/global/rooms/'+this['name'];this['cpworld']['music']&&this['cpworld']['musicKey']!==this['music_id']['toString']()&&(this['cpworld']['music']['stop'](),this['cpworld']['music']=null);switch(this['type']){case'room':const cloneCrumb=this.cpworld.crumbManager.getRoomCrumbByName(this.room_clone);if(this.room_clone&&cloneCrumb){_0x11fe35=this.room_clone.charAt(0).toUpperCase()+this.room_clone.slice(1);this.name=this.room_clone;this.sceneKey=`${_0x11fe35}Room`;}else{this.sceneKey=`${_0x11fe35}Room`;}this.loadRoom();break;case'game':this.sceneKey=`${_0x11fe35}Game`;this.loadGame();break;case'igloo':this.cpworld.logger.info('Loading igloo: '+`${_0x11fe35}Igloo`);this.sceneKey='IglooScene';this.loadIgloo();break;}}preloadRoom(scene){this.scene=scene;if(this.type==='game'){this.cpworld.closeLoading();return;}this.playerLoadTimer=this.scene.time.addEvent({delay:1,callback:this.onPreloadPlayersTick,callbackScope:this,loop:true});setTimeout(()=>{if(!this.finishedPlayerPreload){this.finishPlayerPreload();}},5000);const name=this.type==='igloo'?'Igloo':this.english;this.cpworld.showLoading(null,null,false,`Joining ${name}`,this.scene,false);}onPreloadPlayersTick(){const remaining=this.cpworld.room.remainingQueuePlayers;if(remaining>=1){const nextIndex=Object.keys(this.cpworld.room.playerLoadQueue)[0];const player=this.cpworld.room.playerLoadQueue[nextIndex];if(player&&player.prefab){if(player.isLocal||player.prefab.clothingSprites.length+player.prefab.errorClothingSprites.length===6){this.cpworld.room.remainingQueuePlayers--;delete this.cpworld.room.playerLoadQueue[player.id];}}}else{this.finishPlayerPreload();}}finishPlayerPreload(){if(!this.finishedPlayerPreload){this.finishedPlayerPreload=true;this.playerLoadTimer.remove();const name=this.type==='igloo'?'Igloo':this.english;this.cpworld.closeLoading(`Joining ${name}`);this.cpworld.uiManager.stamp_notify.showNextInQueue();if(!this.cpworld.invisibleWarningShown&&this.cpworld.player.moderator){this.cpworld.invisibleWarningShown=true;this.cpworld.showPrompt('ok','You are currently invisible. Press the icon at the top right to toggle.');}}}setupRoom(scene){this.scene=scene;if(this.scene.roomReference){window.mailOffsetPST=0;}this.cpworld.uiManager.roomReset(this.cpworld.room.type==='game');scene.scene.bringToTop('UIManager');scene.scene.bringToTop('PreloadScene');this.cpworld.keyBindManager.startQuickKeys(this.scene);}loadRoom(){this.cpworld.showLoading(scene=>{if(Object.keys(this.cpworld.cachedRooms).length<1){scene.setMessageText('Loading Penguin');scene.load.pack(`player`,`assets/client/player/player_pack.json?v=1.7.29-beta`);scene.load.multiatlas('c_penguin_body','assets/content/global/character/penguin_body.json?v=1.7.29-beta','assets/content/global/character/');scene.load.multiatlas('c_penguin_features','assets/content/global/character/penguin_features.json?v=1.7.29-beta','assets/content/global/character/');scene.load.image('blue-ring','assets/content/global/character/blue-ring.png?v=1.7.29-beta');scene.load.image('green-ring','assets/content/global/character/green-ring.png?v=1.7.29-beta');scene.load.image('shadow','assets/content/global/character/shadow.png?v=1.7.29-beta');scene.setMessageText('Loading Interface');scene.load.pack('room_basic_client','assets/client/room_basic_pack.json?v=1.7.29-beta');scene.load.pack('i_room_basic_content','assets/content/global/interface/core/i_room_basic_content_pack.json?v=1.7.29-beta');scene.load.pack('room_audio_content','assets/content/global/audio/client/room_audio_content.json?v=1.7.29-beta');}if(!this.cpworld.cachedRooms[this.id]){this.cpworld.cachedRooms[this.id]=this.id;}this.physicsKey=`room_physics_${this.name}`;scene.load.pack(`${this.name}_content`,`assets/content/global/rooms/${this.name}/${this.name}_content.json?v=1.7.29-beta`);scene.load.script(this.sceneKey,`assets/client/scenes/rooms/${this.name}/${this.sceneKey}.js?v=1.7.29-beta`);scene.load.animation(`${this.name}_animations`,`assets/client/scenes/rooms/${this.name}/animations.json?v=1.7.29-beta`);scene.load.pack(`${this.name}_extra`,`assets/client/scenes/rooms/${this.name}/${this.name}_extra.json?v=1.7.29-beta`);scene.load.json(this.physicsKey,`assets/content/global/rooms/${this.name}/physics.json?v=1.7.29-beta`);},scene=>{this.cleanupScenes();scene.scene.add(this.sceneKey,eval(`new ${this.sceneKey}()`));this.cpworld.game.scene.start(this.sceneKey,{roomId:this.id,room:this,cpworld:this.cpworld});},true,`Loading ${this.english}`,null,true);}loadIgloo(){this.cpworld.showLoading(scene=>{const scaleVariant=this.cpworld.primaryScaleVariant;this.physicsKey=`igloo_physics_${this.name}`;const musicId=this.iglooData.music.toString();scene.load.multiatlas(`${this.name}@4x`,`assets/content/global/igloo/buildings/sprites/${this.name}/${this.name}@4x.json?v=1.7.29-beta`,`assets/content/global/igloo/buildings/sprites/${this.name}/`);if(!this.loadedBuildings.includes(`${this.name}@4x`)){this.loadedBuildings.push(`${this.name}@4x`);}if(this.iglooData.music!=='0'){scene.load.audio(musicId.toString(),`assets/content/global/audio/${musicId}.mp3`);}if(this.iglooData.location!==0){scene.load.multiatlas(`igloo_location_${this.iglooData.location}${scaleVariant}`,`assets/content/global/igloo/locations/sprites/${this.iglooData.location}${scaleVariant}.json?v=1.7.29-beta`,`assets/content/global/igloo/locations/sprites/`);}scene.load.json(this.physicsKey,`assets/content/global/igloo/buildings/sprites/${this.name}/physics.json?v=1.7.29-beta`);},scene=>{this.cleanupScenes();scene.scene.add('IglooScene',new IglooScene('IglooScene'));this.cpworld.game.scene.start('IglooScene',{roomId:this.id,room:this,cpworld:this.cpworld});},true,`Loading Igloo`,null,true);}loadGame(){this.cpworld.showLoading(scene=>{if(!this.cpworld.cachedRooms[this.id]){this.cpworld.cachedRooms[this.id]=this.id;this.physicsKey=`room_physics_${this.name}`;scene.load.animation(`${this.name}_animations`,`assets/client/scenes/games/${this.name}/animations.json?v=1.7.29-beta`);scene.load.pack(`${this.name}_extra`,`assets/client/scenes/games/${this.name}/${this.name}_extra.json?v=1.7.29-beta`);scene.load.script(this.sceneKey,`assets/client/scenes/games/${this.name}/${this.sceneKey}.js?v=1.7.29-beta`);scene.load.pack(`${this.name}_content`,`assets/content/global/games/${this.name}/${this.name}_content.json?v=1.7.29-beta`);scene.load.json(this.physicsKey,`assets/content/global/games/${this.name}/physics.json?v=1.7.29-beta`);}},scene=>{this.cleanupScenes();scene.scene.add(this.sceneKey,eval(`new ${this.sceneKey}()`));this.cpworld.game.scene.start(this.sceneKey,{roomId:this.id,room:this,cpworld:this.cpworld});},true,`Loading ${this.english}`,null,true);}cleanupScenes(){if(this.cpworld.lastRoomSceneKey){this.cpworld.game.scene.remove(this.cpworld.lastRoomSceneKey);}this.cpworld.game.scene.remove('IglooScene');}destroyRoom(){if(!this.scene){this.cpworld.logger.error('[Room] Scene was undefined when trying to destroy room.');return;}const roomPack=this.scene.cache.json.get(`${this.name}_content`);const animationsPack=this.scene.cache.json.get(`${this.name}_animations`);if(this.type!=='game'){if(roomPack){for(let i=0;i<roomPack.section1.files.length;i++){const file=roomPack.section1.files[i];if(file.type==='multiatlas'){const texture=this.scene.textures.get(file.key);if(texture){for(const animationKey in this.scene.game.anims.anims.entries){const animation=this.scene.game.anims.anims.entries[animationKey];if(animation.frames[0]&&animation.frames[0].textureKey===file.key){this.scene.game.anims.remove(animationKey);}}this.cpworld.logger.info(`[Room] Destroying multi-atlas ${file.key}`);this.scene.textures.remove(file.key);}}}this.scene.cache.json.remove(`${this.name}_content`);}if(animationsPack){this.scene.cache.json.remove(`${this.name}_animations`);}}if(this.scene.iglooRenderer){this.scene.iglooRenderer.shutdownRenderer();}for(let i=0;i<this.loadedBuildings.length;i++){const atlasKey=this.loadedBuildings[i];const texture=this.scene.textures.get(atlasKey);if(texture){this.scene.textures.remove(atlasKey);if(this.cpworld.loadedDynamicPacks[atlasKey]){delete this.cpworld.loadedDynamicPacks[atlasKey];}}}this.cpworld.room.scene.input.keyboard.removeAllListeners('keydown-ENTER');this.cpworld.room.scene.events.removeAllListeners();this.cpworld.keyBindManager.stopQuickKeys();this.roomEvents.emit('room_destroy',this);}getPlayerByNickname(nickname){for(const id in this.cpworld.room.players){const player=this.cpworld.room.players[id];if(player.nickname===nickname){return player;}}}getPlayerById(id){return this.cpworld.room.players[id.toString()];}}